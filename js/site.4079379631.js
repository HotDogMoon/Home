/*
 memebetter.com all rights reserved.
*/
(function(d,a,x,G){function T(){n.on({dragover:function(){a.dropzone.fadeIn(200);return!1},drop:function(b){a.dropzone.fadeOut(200);d(b.target).is("input[type=file]")||b.preventDefault()}});a.dropzone.on({dragover:function(){return!1},dragleave:function(){d(this).fadeOut(200);return!1},dragend:function(){d(this).fadeOut(200);return!1},drop:function(b){b.preventDefault();a.dropzone.fadeOut(200);"undefined"!=typeof b.originalEvent.dataTransfer.files[0]&&H(b.originalEvent.dataTransfer.files[0])}})}function I(b){var c=
a.context.font;a.context.font="60px monospace";var e=a.context.measureText("abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz").width;a.context.font="60px "+b+", monospace";b=a.context.measureText("abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz").width;a.context.font=c;return e!==b}function J(){var b=parseInt(.8*u.height(),10);200>b&&(b=200);a.A.css("max-height",b+"px")}function K(){a.context.textAlign="center";a.context.fillStyle="#FFF";a.context.lineStyle="#000";var b=((a.canvas.width>
a.canvas.height?a.canvas.height:a.canvas.width)+(a.canvas.width>a.canvas.height?a.canvas.width:a.canvas.height))/2,c=.014;500>b&&(c+=.005);a.fontSize=parseInt(a.U*b,10);a.context.font=a.fontSize+"pt "+a.fontFamily;a.context.lineWidth=parseInt(c*b,10);L.P={x:a.canvas.width/2,y:a.canvas.height/2}}function U(){var b=d("html");if(b.hasClass("no-canvas")&&b.hasClass("no-canvastext")||0<=navigator.userAgent.indexOf("Opera Mini"))b.addClass("app-nosupport"),b='<div class="panel"><h4>Sorry, your browser is unable to run the Meme Generator.</h4>',
navigator.userAgent.indexOf("Opera Mini")?b+="<p>Opera Mini is not compatible with our image manipulation techniques, please use the Android or Safari browser, Chrome, or Firefox mobile for the best experience with our meme generator.</p>":'<p>If possible, please do consider upgrading or installing a more recent browser. <a href="https://memebetter.com/faq#not-working-for-me">Learn more.</a></p>',b+="</div>",d(".no-support-message .error").append(b),d(".interface").hide();else{b.addClass("app-supported");
a.canvas=d("#rasterizer").get(0);a.context=a.canvas.getContext("2d");a.m=d("#first-line");a.p=d("#last-line");a.V=Hogan.compile(d("#memeChoiceTemplate").html());a.h=d("#meme-choices");a.ba=d(".workspace");a.dropzone=d("#dropzone");a.S=d(".fileLoad");a.A=d("#rendered");a.g=d("#refresh-action");a.N=d(".pagination");a.u=d("#editor");a.l=d("#quicksearch");a.q=d(".meme-picker .alert-box");a.q.html('<i class="fa fa-exclamation-triangle"></i> Sorry, no images matched those keywords.');a.e=!1;a.browser=browserCheck();
a.j=d("button.live-mode");"undefined"!=typeof d.cookie("disable_refresh")&&d.cookie("disable_refresh")?M():a.j.attr("title",a.j.data("title-on"));769<u.width()&&(y=16);V();B();a.h.on("click","img",W);n.on("click touchstart",".close",N).on("click touchstart",".text-form .close",function(){!0===v&&(z(),A())});for(var b=[],c=0;c<C.length;c++)b.push('"'+C[c].font+'"');a.fontFamily=b.join(", ");I("Impact")&&(a.R=!0);b=I(C[0].font)?0:1;a.U=C[b].w;a.T=C[b].lineHeight;u.resize(J);J();K();x.File&&x.FileList&&
x.FileReader?(T(),a.S.on("change",function(a){"undefined"!=typeof a.currentTarget.files[0]&&H(a.currentTarget.files[0])})):d(".requires-fileapi").hide()}}function E(b,c){for(var e=[],g=b.replace(/^\s+|\s+$/,"").replace(/\s\s*/g," ").split(" "),d=-1,m=0,f=a.context.measureText(" ").width,h=0;h<g.length;h++){var k=a.context.measureText(g[h]).width;if(k>c){var l=Math.floor(g[h].length/2),k=g[h].substr(0,l),l=g[h].substr(l),n=g.splice(0,h);g[0]=l;g.unshift(k+"-");g=n.concat(g);k=a.context.measureText(g[h]).width}if("undefined"==
typeof e[d]||m+f+k>c)d++,m=0,e[d]=[];e[d].push(g[h]);m=0===m?k:m+f+k}if(0<d)for(g=e.length-1;0<g;g--)for(d=g-1,m=e[d].length-1;0<m;m--)if(f=Math.abs(a.context.measureText(e[d].join(" ")).width-a.context.measureText(e[g].join(" ")).width),e[g].unshift(e[d].pop()),Math.abs(a.context.measureText(e[d].join(" ")).width-a.context.measureText(e[g].join(" ")).width)>=f){e[d].push(e[g].shift());break}return e}function N(b){b.preventDefault();d(b.currentTarget).parent().find("input").val("");!1!==v||a.g.is(":visible")||
a.g.fadeIn(300)}function O(b,c){a.context.save();a.context.setTransform(1,0,0,1,0,0);c=!0===c;var e=parseInt(.97*a.canvas.width,10),d=parseInt(a.fontSize,10)+"pt "+a.fontFamily;a.context.font=d;var r=E(b,e),f=r.length;if(1<r.length)for(var p=Math.ceil(r.length/2),h=1;4>h;h++)if(a.context.font=parseInt(a.fontSize*(1-.1*h),10)+"pt "+a.fontFamily,r=E(b,e),r.length<f)if(d=a.context.font,r.length===p)break;else--f;a.context.font=d;r=E(b,e);e=parseInt(a.context.measureText("M").width*a.T,10);d=c?e:parseInt(.97*
a.canvas.height-(r.length-1)*e,10);for(f=0;f<r.length;f++){var p=r[f].join(" "),h=L.P.x,k=d+f*e;if(a.R){var l=parseInt(a.context.lineWidth/2,10),n=a.context.fillStyle;a.context.fillStyle=a.context.lineStyle;a.context.fillText(p,h+l,k);a.context.fillText(p,h+l,k-l);a.context.fillText(p,h+l,k+l);a.context.fillText(p,h-l,k);a.context.fillText(p,h-l,k-l);a.context.fillText(p,h-l,k+l);a.context.fillText(p,h,k-l);a.context.fillText(p,h,k+l);2<l&&(a.context.fillText(p,h+l,k+2),a.context.fillText(p,h+l,k-
2),a.context.fillText(p,h-l,k+2),a.context.fillText(p,h-l,k-2));a.context.fillStyle=n}else a.context.strokeText(p,h,k);a.context.fillText(p,h,k)}a.context.restore()}function z(){var b=a.canvas.width,c=a.canvas.height;!1===f?a.context.fillRect(0,0,b,c):(5<=f.orientation&&8>=f.orientation&&(b=a.canvas.height,c=a.canvas.width),1>f.O?a.context.drawImage(f,0,0,f.width,f.height,0,0,b,Math.ceil(c/f.O)):a.context.drawImage(f,0,0,b,c));b=a.m.val().toUpperCase();c=a.p.val().toUpperCase();O(b,!0);O(c)}function M(){v=
!v;!0===v?(a.j.addClass("success").removeClass("secondary").attr("title",a.j.data("title-on")),d(".image-render").removeClass("manual"),a.g.fadeOut(300),d.removeCookie("disable_refresh"),A()):(a.j.addClass("secondary").removeClass("success").attr("title",a.j.data("title-off")),d(".image-render").addClass("manual"),d.cookie("disable_refresh","yes"))}function X(b){z();var c=new Date,c="memebetter.com-"+(""+c.getFullYear()+("0"+(c.getMonth()+1)).slice(-2)+("0"+c.getDate()).slice(-2)+("0"+c.getHours()).slice(-2)+
("0"+c.getMinutes()).slice(-2)+("0"+c.getSeconds()).slice(-2))+".jpg";d(b.target).attr("href",a.canvas.toDataURL("image/jpeg")).attr("download",c);n.triggerHandler(t.I,{W:!!a.e,aa:a.e?a.e.attr("title"):null})}function A(){var b=a.A;0===b.length&&(b=d('<img id="rendered" />'),d(a.canvas).parent().append(b),a.A=d("#rendered"));b.get(0).src=a.canvas.toDataURL("image/jpeg");a.ba.show()}function Y(){a.u.is(":visible")?u.scrollTo(0,{duration:400}):a.u.slideDown(200,function(){u.scrollTo(0,{duration:400})})}
function W(b){var c=a.e;a.e=d(b.target);c&&c.removeClass("active");a.e.addClass("active");if(c&&a.m.val()==c.data("prefill-first")&&a.p.val()==c.data("prefill-last")||0===a.m.val().length&&0===a.p.val().length)a.m.val(a.e.data("prefill-first")),a.p.val(a.e.data("prefill-last"));b=a.e.data("url");c=new Image;c.orientation=1;c.onload=P;f=c;f.src=b;n.triggerHandler(t.H,{title:a.e.attr("title")})}function P(){if(0!==f.height&&0!==f.width){var b=f,c=f,e=f.height,d=G.createElement("canvas");d.width=1;d.height=
e;d=d.getContext("2d");d.drawImage(c,0,0);for(var c=d.getImageData(0,0,1,e).data,d=0,r=e,m=e;m>d;)0===c[4*(m-1)+3]?r=m:d=m,m=r+d>>1;e=m/e;b.O=0===e?1:e;b=f.width;e=f.height;5<=f.orientation&&8>=f.orientation&&(b=f.height,e=f.width);if(800<e||800<b)c=e/b,e===Math.max(b,e)?(e=800,b=parseInt(e/c,10)):(b=800,e=parseInt(b*c,10));if(a.canvas.height!=e||a.canvas.width!=b)a.canvas.height=e,a.canvas.width=b,K();a.context.setTransform(1,0,0,1,0,0);switch(f.orientation){case 2:a.context.translate(b,0);a.context.scale(-1,
1);break;case 3:a.context.translate(b,e);a.context.rotate(Math.PI);break;case 4:a.context.translate(0,e);a.context.scale(1,-1);break;case 5:a.context.rotate(.5*Math.PI);a.context.scale(1,-1);break;case 6:a.context.rotate(.5*Math.PI);a.context.translate(0,-b);break;case 7:a.context.rotate(.5*Math.PI);a.context.translate(e,-b);a.context.scale(-1,1);break;case 8:a.context.rotate(-.5*Math.PI),a.context.translate(-e,0)}}a.g.hide();z();A();Y()}function H(b){if(-1!==b.type.indexOf("image")){var c=new FileReader;
c.onloadend=function(a){if(a.target.readyState==FileReader.DONE){a=a.target.result;var b=atob(a.split(",")[1]),b=EXIF.readFromBinaryFile(new BinaryFile(b,0,b.length)).Orientation||1,c=new Image;c.orientation=b;c.onload=P;f=c;f.src=a}};c.readAsDataURL(b);n.triggerHandler(t.G);a.e&&(a.e.removeClass("active"),a.e=!1)}}function Z(){n.on("click","button",function(a){a.preventDefault()}).on("click touchend","#rendered, #refresh-action",function(){a.g.fadeOut(300);z();A()}).on("keyup","#first-line, #last-line",
function(b){27===b.keyCode?N(b):!0===v||13===b.keyCode?(z(),A()):a.g.is(":visible")||a.g.fadeIn(300)}).on("click",".live-mode",function(){M();n.triggerHandler(t.B,{X:v});z();!0===v&&A()}).on("click",".pick-image",function(){a.u.slideUp()}).on("click",".save-image",X).on("click",".meme-picker .close",function(a){d("#quicksearch").val("");a.preventDefault();B(a)}).on("keyup","#quicksearch",B).on("blur","#quicksearch",function(){3<=d.trim(a.l.val()).length&&n.triggerHandler(t.J,{Z:a.l.val(),Y:a.h.find(".meme-choice").length})}).on("click",
".pagination .arrow, .pagination .page",aa).on("click",".view-all",function(){y=200;q=1;d(".pagination").remove();d(".view-all [data-alt]").each(function(){var a=d(this);a.attr("class",a.data("alt"))});n.triggerHandler(t.D);B()}).on("click",".view-latest",function(){var b=a.k.filter(function(b,d){return a.M[d]||!1});1>b.length||(a.h.empty(),F(b),d(".pagination .current").removeClass("current"),n.triggerHandler(t.F))});d.cookie.defaults.expires=365}function aa(b){b.preventDefault();b=d(b.target);b.hasClass("next")?
q+1<=D&&(q+=1):b.hasClass("prev")?1<=q-1&&--q:(b=parseInt(b.text(),10),b!=q&&(q=b));var c,e;3<=q?(e=Math.min(D,q+3),c=e-6+1):(c=1,e=6);b=d(".pagination");b.find(".page:lt("+(c-1)+")").hide();b.find(".page:gt("+(c-1)+"), .page:eq("+(c-1)+")").show();b.find(".page:gt("+(e-1)+")").hide();c=a.l;e=u.scrollTop();var g=e+u.height(),f=c.offset().top;f+c.height()<=g&&f>=e||u.scrollTo(a.l);d(".pagination .current").removeClass("current");b.find("li:eq("+q+")").addClass("current");n.triggerHandler(t.C,{Q:q});
B()}function F(b){if(d.isArray(b))d.each(b,function(a,b){var c=b.find("img:not([src])");c.attr("src",c.data("src"))});else{var c=b.find("img:not([src])");c.attr("src",c.data("src"))}a.h.append(b)}function B(b){"undefined"!=typeof b&&27===b.keyCode&&a.l.val("");var c=d.trim(a.l.val()),e=[];if(3<=c.length||c.match(/\d{2,}/)){a.N.hide();for(var g=Q(c),g=3>g.length?!1:g.split(" "),f=0;f<a.k.length;f++){var m=0,m=g&&ba(g,a.L[f])?Math.min(.5+.1*g.length,.9):a.K[f].score(c);.35<=m&&e.push([f,m])}e.sort(function(a,
b){return b[1]-a[1]});e.length?a.q.hide():a.q.show();a.h.empty();c=Math.min(e.length,y);for(g=0;g<c;g++)F(a.k[e[g][0]]);1===e.length&&"undefined"!=typeof b&&13===b.keyCode&&a.k[e[0][0]].find("img").click()}else a.N.show(),a.q.hide(),a.h.empty(),F(a.k.slice((q-1)*y,q*y))}function Q(a){return a.toLowerCase().replace(/[^a-z0-9 ]/g,"").split(" ").sort().filter(R).join(" ")}function ba(a,c){for(var d=-1,g=-1,f=0,m=a.length;f<m;++f)if(d=c.indexOf(a[f],g),0<=d&&d>g)g=d;else return!1;return 0<=d}function R(a,
c,d){return-1===d.indexOf(a,c+1)}function V(){a.k=[];a.K=[];a.L=[];a.M=[];S=a.a.images.length;D=Math.ceil(S/y);d(".pagination .page").remove();for(var b=1;b<=D;b++){var c=d('<li class="page page-'+b+'"><a href="">'+b+"</a></li>");c.data("pagingNum",b);6<=b-1&&c.hide();1===b&&c.addClass("current");d(".pagination .next").parent().before(c)}for(b=0;b<a.a.images.length;b++){c=d.trim(a.a.images[b].title).split(" ");a.a.images[b].keywords&&a.a.images[b].keywords.length&&(c=c.concat(d.trim(a.a.images[b].keywords).split(" ")));
"undefined"!=typeof a.a.images[b].prefill&&("string"==typeof a.a.images[b].prefill.first&&(c=c.concat(d.trim(a.a.images[b].prefill.first).split(" "))),"string"==typeof a.a.images[b].prefill.last&&(c=c.concat(d.trim(a.a.images[b].prefill.last).split(" "))));var c=c.filter(R),e={src:a.a.base+a.a.images[b].src,thumbnail:a.a.base+a.a.images[b].src.split(/\.[a-z]{3}/)[0]+"_t.jpg",name:a.a.images[b].title};"undefined"!=d.type(a.a.images[b].prefill)&&("string"==d.type(a.a.images[b].prefill.first)&&(e["prefill-first"]=
a.a.images[b].prefill.first),"string"==d.type(a.a.images[b].prefill.last)&&(e["prefill-last"]=a.a.images[b].prefill.last));e=d(a.V.render(e));a.k[b]=e;a.K[b]=c.join(" ");a.L[b]=Q(c.join(" "));a.M[b]=a.a.images[b].latest||!1}}var v=!0,f=!1,C=[{font:"Impact",w:.08,lineHeight:1.4},{font:"Passion One",w:.11,lineHeight:1.15},{font:"sans-serif",w:.11,lineHeight:1.15}],L={},y=12,q=1,S,D,w=Math.random().toString(36).substring(7),t={H:"e01"+w,G:"e02"+w,B:"e03"+w,D:"e04"+w,C:"e05"+w,J:"e06"+w,I:"e07"+w,F:"e08"+
w},n=d(G),u=d(x);d.MemeGenerator=function(b){a.a=b||{};"undefined"===typeof x._gaq&&(x._gaq=[]);n.ready(U);b=n.find("body");d.browser.mobile?b.addClass("is-mobile"):b.addClass("is-desktop");Z()};(function(a,c){a.on(c.H,function(a,b){ga("send","event","Meme","Pick",b.title)});a.on(c.G,function(){ga("send","event","Meme","Load Custom")});a.on(c.D,function(){ga("send","event","Navigate","View All")});a.on(c.F,function(){ga("send","event","Navigate","View Latest")});a.on(c.B,function(a,b){ga("send","event",
"Config","Auto Refresh",b.X?"Enabled":"Disabled")});a.on(c.I,function(a,b){var c={eventCategory:"Meme"};b.W?(c.eventAction="Save",c.eventLabel=b.aa):c.eventAction="Save Custom";ga("send","event",c)});a.on(c.C,function(a,b){ga("send","event","Navigate","Pagination","Page "+b.Q)});if("yes"!==navigator.doNotTrack&&1!==navigator.doNotTrack)a.on(c.J,function(a,b){ga("send","event",{eventCategory:"Navigate",eventAction:b.Y?"Search Hit":"Search Miss",eventLabel:b.Z})})})(n,t)})(jQuery,{},window,document);
